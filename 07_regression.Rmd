# La regresión

En este capítulo vamos a revisar el elemento básico para hacer modelos estadísticos: la regresión lineal.

## Modelos estadísticos
Revisa este <a href="https://www.youtube.com/watch?v=DOIjIB1FGYY" target="_blank">video (17')</a> y trata de responder:

- ¿Qué es un modelo estadístico?
- ¿Por qué es importante tener buenos modelos?
- ¿Cómo de determina el error en un modelo?
- ¿Qué son los grados de libertad?

## La ecuación de la recta
Revisa este <a href="https://www.youtube.com/watch?v=In1vL_kZeYk" target="_blank">video (8')</a> y trata de responder:

- ¿Cómo se define la línea de la ecuación de un GLM que se ajuste mejor a los datos?
- ¿Cuál es el modelo más básico con el cual se compara un modelo que uno construya?

## La suma de cuadrados
Revisa este <a href="https://www.youtube.com/watch?v=maFx6TKuaQI" target="_blank">video (14')</a> y trata de responder:

- ¿Qué es la SS total?
- ¿Qué es la SS de los residuales?
- ¿Qué es la SS del modelo?
- ¿Cómo se establece que un modelo dado explica mejor los datos que un modelo básico?
- ¿Cómo se establece cuan bueno es un modelo comparado con cuan malo es? ¿Lo que explica y lo que no explica un modelo?

## La regresión con R

Ahora vamos a hacer un análisis básico de regresión. Primero seteamos nuestro directorio de trabajo y cargamos las librerías que necesitemos (si no las tienes instaladas debes instalarlas). Luego importamos el set de datos y le damos una mirada.

```{r}
setwd("C:/Users/Usuario/Documents/JoseLuis/UTalca_2018/Estadistica_Bookdown/estadistica")

library(ggplot2)
library(car)
```

Imagina que eres manager de un grupo musical y debes definir como invertir parte de tu presupuesto. A lo que aspiras en el fondo esa aumentar la venta de discos. Para ellos pirmero debes evaluar que factores afectan la venta de discos. Uno de estos factores es la cantidad de dineo invertido en la publicidad. En ese sentido, te gustaría saber cuál es la relación entre el dinero invertido en publicidad y el número de discos vendidos.

```{r}
album1 <- read.csv("data/datos_ventas_de_discos_1.csv", header = TRUE) # load data
head(album1)
```

Primero graficamos.

```{r}
ggplot(album1,
       aes(publicidad, ventas)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x="Cantidad de dinero gastado en publicidad",
       y="Ventas")
```

Lo que nos dice el sentido común, y lo que vemos en el gráfico efectivamente es que a mayor dinero invertido en publicidad debería haber mayores ventas. Es este un buen modelo para predecir el número de ventas a partir del dinero invertido en publicidad? Para analizar estos podemos hacer un modelo lineal con la función **lm**. En esta función usamos la típica relación entre resultado (ouctome) y variable explicativa (predictor), y le indicamos a R que base de datos usamos (datos):
newModel <- lm(outcome~predictor, datos)
Luego podemos visualizar los resulatdos con la función **summary**.

```{r}
m_album <- lm(ventas ~ publicidad, data = album1)
summary(m_album)
```

En qué debemos fijarnos dentro de los resultados que obtenemos al aplicar un módelo líneal?
En la línea siguientes a "Call" aparece el módelo que usamos.
También aparecen los llamados coeficientes que reflejan bajo el nombre de "Estimate" que refleja con que magnitud una variable predictora predice una variable resultado. Por ejemplo, por cada unidad de publicidad invertida el aumento en el número de ventas es 0.09. Y esta relación es significativa, o sea es diferente de 0 (lo que ocurre cuando no hay ninguna relación entre ambas variables).


En el fondo este análisis nos dice que la publicidad si impacta sobre la venta de los discos.
Sin embargo, a publicidad no es el único que podría afectar las ventas. En este sentido, podríamos estudiar otros factores que afectan esta variable resultados. Para ello hacemos lo que se llama una regresión múltiple.

Primero cargamos los datos.
```{r}
album2 <- read.csv("data/datos_ventas_de_discos_2.csv", header = TRUE) # load data
head(album2)
```

Podemos graficar la relación entre alguna variable de interés y el número de ventas.
Por ejemplo, podríamos visualizar el impacto de la frecuencia de aparición de un tema musical en la radio.

```{r}
ggplot(album2,
       aes(publicidad, radio)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x="Número de apariciones en la radio",
       y="Ventas")
```

Luego podríamos hacer un modelo para entender el impacto de distintos factores en la venta de discos.

```{r}
m_album2 <- lm(ventas ~ publicidad + radio + eventos, data = album2)
summary(m_album2)
```

¿Qué conclusiones sacas de este análisis?
